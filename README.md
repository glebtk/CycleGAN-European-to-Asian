
# European To Asian CycleGAN
## Что такое CycleGAN?

---


**CycleGAN** - это архитектура нейронной сети, позволяющая
проводить трансформации между изображениями двух разных распределений.<br>
Простым языком, это штука, которая может **из одних картинок делать другие**.

**Например**, можно превратить изображения лошадей в изображения
зебр и наоборот:

![Картинка][horses]<br>

Или превратить яблоки в апельсины:

![Картинка][apples]<br>

**Подробнее можно почитать в оригинальной статье на Архиве**
[![arXiv](https://img.shields.io/badge/arXiv-Paper-<COLOR>.svg)](https://arxiv.org/pdf/1703.10593.pdf).

## Описание проекта

---
### Идея 

**Главная идея** - научить нейросеть изменять лицо европейской внешности 
таким образом, чтобы оно считывалось человеком как азиатское, но
при этом не теряло узнаваемости.

**Главная проблема** - отсутствие пар изображений.<br>

Поскольку у нас не может быть двух фотографий, где один и тот же 
человек азиат и европеец, было решено использовать 
циклический GAN (CycleGAN), так как данная архитектура не требует 
пар изображений.

### Реализация

Проект реализован на **Python 3** с использованием фреймворка 
для глубокого обучения **PyTorch**. Отслеживание процесса обучения
в реальном времени реализовано с помощью **TensorBoard**.<br>

Использована оригинальная идея циклического GAN'а. 
Архитектура дискриминатора сохранена, в архитектуру генератора
для оптимизации вычислений внесены небольшие изменения.

### Архитектура проекта

**Файл конфигурации**

![Картинка][config]<br>
Фактически представляет собой "приборную панель" всего проекта.
Здесь можно изменять гиперпараметры, настройки обучения,
аугментации и т.д.

**Обучение**

![Картинка][train]<br>
Здесь реализован главный цикл обучения нейронной сети, а также загрузка 
и сохранение чекпоинтов в процессе обучения.

**Модели**

![Картинка][models]<br>
В этих документах находятся классы генератора и дискриминатора.

**Датасет**

![Картинка][dataset]<br>
Здесь реализован кастомный датасет.

**Тесты**

![Картинка][tests1]<br>
Здесь реализовано тестирование работы генераторов 
в процессе обучения.

![Картинка][tests2]<br>
А здесь тестирование работы датасета и аугментаций.

**Утилиты**

![Картинка][utils]<br>
Этот документ содержит некоторые вспомогательные функции.
Такие, как загрузка чекпоинта, постпроцессинг изображений, и т.д.

**Загрузка файлов**

![Картинка][download]<br>
Скрипт, позволяющий в одно нажатие загрузить датасет, 
предобученные веса и тестовые изображения.




## Примеры работы

---
Как можно видеть на изображении ниже, результатом работы 
модели являются лица, которые на низком уровне идентичны оригинальным,
а на высоком приобрели характерные азиатские признаки

![Картинка][results]<br>

## Датасет

---
* **Датасет для обучения нейронной сети состоит из 
2048 изображений лиц** размера 256x256 пикселей, из 
которых 1024 стереотипно европейской внешности, и 1024 
стереотипно азиатской.

* **Женских** и **мужских** лиц примерно поровну.

* Основную часть составляют лица условных 
возрастных рамок **20-40 лет.**


#### Class A: 1024 European<br> 
   - ~512 Female (~16-55)
   - ~512 Male (~9-55)

![Картинка][european_dataset]


#### Class B: 1024 Asian<br> 
   - ~512 Female (~16-70)
   - ~512 Male (~10-65)

![Картинка][asian_dataset]

## Рекомендации к обучению

---
* Приведенных выше результатов можно добиться обучая 
модель в **течении 100 эпох** со стандартными настройками config,
а далее с шагом в 5 эпох **снизить learning rate до 3e-5**.
* До начала обучения можно эксперементально увеличить параметр
     **lambda cycle** до 15-20
* **При изменении размеров** входного избражения следует изменять 
  количество **residual** слоёв. Например, для изображений 128x128 
  достаточно всего шесть
* Параметр **batch size** рекомендовано оставить равным однму.
  Эксперементально выяснено, что увеличение размера батчей не даёт 
  существенного прироста к скорости сходимости сети
* Обучать модель рекомендуется с использованием **GPU**

## Colab Notebook

---
**Быстро протестировать работу нейросети с предобученными весами 
можно в Google Colab**
[![Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/drive/1tgz_iiSEL-iSf1DCM4lXCJ0WJUT061FS?usp=sharing).

## Способы связи

---
**E-mail:** tutikgv@gmail.com <br>
**Telegram:** @glebtutik


[horses]: https://i.imgur.com/KSKjn8l.jpg "Horses"
[apples]: https://i.imgur.com/PAciYyU.jpg "Apples"

[results]: https://i.imgur.com/74P7nND.png "Results"

[config]: https://i.imgur.com/d73gkWx.png "Config"
[train]: https://i.imgur.com/VBHs7ZT.png "Train"
[models]: https://i.imgur.com/FGaOszf.png "Models"
[dataset]: https://i.imgur.com/dbcIfM5.png "Dataset"
[tests1]: https://i.imgur.com/pXvQ6O9.png "Model test"
[tests2]: https://i.imgur.com/YksQDba.png "Dataset test"
[utils]: https://i.imgur.com/KUfypn6.png "Utils"
[download]: https://i.imgur.com/5NmQcQY.png "Download files"


[asian_dataset]: https://i.imgur.com/8WlZwwe.jpeg "Датасет asian"
[european_dataset]: https://i.imgur.com/c5y4XEA.jpg "Датасет european"